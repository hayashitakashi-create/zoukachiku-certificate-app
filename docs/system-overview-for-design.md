# 増改築等工事証明書管理システム - システム概要（デザイン用）

## システム全体概要

### 目的
住宅の増改築・改修工事における各種税制優遇制度（住宅借入金等特別控除、固定資産税減額等）の申請に必要な「増改築等工事証明書」を作成・管理するWebアプリケーション。

### ターゲットユーザー
- 建築士事務所
- 工務店
- リフォーム業者
- 一級建築士・二級建築士

### 技術スタック
- Next.js 16.1.4 (App Router)
- TypeScript
- Prisma ORM + PostgreSQL
- Tailwind CSS
- ExcelJS (Excel出力)
- PDF-lib (PDF出力)

---

## 1. ダッシュボード（ホームページ）

### URL
`/` (http://localhost:3000/)

### 主な機能

#### 1.1 ヘッダーセクション
- **タイトル**: 「増改築等工事証明書管理システム」
- **サブタイトル**: 「住宅改修工事の証明書を簡単に作成・管理」
- **アクションボタン**:
  - 「新規証明書作成」ボタン（プライマリCTA）
  - 「設定」ボタン（証明者情報のデフォルト設定）

#### 1.2 統計カードセクション
4つのカードを横並びで表示（レスポンシブ対応）:
1. **総証明書数**
   - アイコン: 📄
   - 背景色: 青系グラデーション
   - 表示内容: 発行済み証明書の総数

2. **下書き**
   - アイコン: 📝
   - 背景色: 黄色系グラデーション
   - 表示内容: 下書き状態の証明書数

3. **発行済み**
   - アイコン: ✅
   - 背景色: 緑系グラデーション
   - 表示内容: 発行済み状態の証明書数

4. **今月の発行数**
   - アイコン: 📅
   - 背景色: 紫系グラデーション
   - 表示内容: 当月に発行された証明書数

#### 1.3 証明書一覧テーブル
すべての証明書を一覧表示（最新順）:

**テーブル列**:
1. 申請者氏名
2. 物件所在地
3. **用途**（NEW!）
   - 住宅借入金等特別控除
   - 住宅借入金等特別税額控除
   - 既存住宅売買瑕疵保険加入用
   - 固定資産税減額用
4. 発行日
5. ステータス
   - 下書き（グレーバッジ）
   - 発行済み（グリーンバッジ）
   - 完了（ブルーバッジ）
6. 作成日
7. アクション
   - 「詳細」ボタン → 証明書詳細ページへ遷移

**機能**:
- ページネーション（10件/ページ）
- 各行クリックで詳細ページへ遷移可能
- レスポンシブ対応（スマホではカード表示）

#### 1.4 空状態（証明書がない場合）
- 大きなアイコン: 📝
- メッセージ: 「まだ証明書が作成されていません」
- サブメッセージ: 「新規証明書作成ボタンから最初の証明書を作成しましょう」

### デザイン要件
- **カラースキーム**:
  - プライマリ: ブルー系（#2563eb）
  - セカンダリ: グレー系
  - アクセント: 各統計カードごとに異なるグラデーション
- **レイアウト**:
  - 最大幅: 7xl (max-w-7xl)
  - パディング: px-4, py-8
  - 背景: グラデーション（from-gray-50 to-gray-100）
- **タイポグラフィ**:
  - ヘッドライン: 3xl, bold
  - サブヘッド: text-gray-600
  - テーブルヘッダー: xs, uppercase, font-medium
- **シャドウ**: shadow-md（カード、テーブル）

---

## 2. 証明書作成フロー

### URL
`/certificate/create` （または `/certificate/create?id={certificateId}` で編集モード）

### ステップ構成（3ステップ）

#### ステップ1: 基本情報
**入力項目**:
- 申請者氏名（必須）
- 申請者住所（必須）
- 物件番号（任意）
- 物件所在地（必須）
- 工事完了年月日（必須、日付ピッカー）
- 用途区分（必須、ラジオボタン）:
  1. 住宅借入金等特別控除
  2. 住宅借入金等特別税額控除（投資型減税）
  3. 既存住宅の譲渡所得の特別控除等
  4. 固定資産税の減額

**補助金情報**:
- 補助金の有無（ラジオボタン: 有/無）
- 補助金額（有の場合のみ表示、数値入力）

#### ステップ2: 改修工事詳細
**表示内容**:
- 選択された用途に基づく説明
- 各改修工事種別へのリンク:
  - 耐震改修工事 🏗️
  - バリアフリー改修工事 ♿
  - 省エネ改修工事 🌱
  - 同居対応改修工事 👨‍👩‍👧‍👦
  - 子育て対応改修工事 👶
  - その他増改築等工事 🔨

**特別な処理**:
- 用途が「住宅借入金等特別控除」の場合:
  - 住宅借入金詳細入力ページへのリンクを表示
  - 工事種別、工事内容、費用概要を入力

#### ステップ3: 証明者情報
**入力項目**:
- 証明者氏名（必須）
- 所属事務所名（必須）
- 組織種別（必須、選択式）:
  - 建築士事務所
  - 指定確認検査機関
  - 登録住宅性能評価機関
  - 住宅瑕疵担保責任保険法人
- 資格番号（必須）
- 発行日（必須、日付ピッカー）

**デフォルト設定機能**:
- 設定ページで保存した証明者情報を自動入力
- 「設定から読み込む」ボタン

### 確認ページ
すべての入力内容を表示:
- 基本情報
- 用途区分
- 証明者情報
- アクションボタン:
  - 「下書きとして保存」
  - 「発行する」（ステータスを「発行済み」に変更）

---

## 3. 証明書詳細ページ

### URL
`/certificate/[id]`

### セクション構成

#### 3.1 ヘッダー
- タイトル: 「証明書詳細」
- ステータスバッジ（下書き/発行済み/完了）
- 作成日表示
- アクションボタン:
  - 「一覧に戻る」
  - 「証明書プレビュー」（NEW!）
  - 「ブラウザ印刷」
  - 「PDF出力」
  - 「削除」（赤色、確認モーダル表示）

#### 3.2 基本情報カード
- 申請者氏名
- 申請者住所
- 物件番号
- 物件所在地
- 工事完了年月日
- 「編集」ボタン（ステップ1へ遷移）

#### 3.3 用途区分カード
- 証明書の用途（日本語表記）
- 「詳細」ボタン → モーダル表示
  - **住宅借入金等特別控除の場合**:
    - 入力された工事種別を表示（第1号〜第6号工事）
    - 工事内容の詳細
    - 費用概要（総額、補助金、控除対象額）
  - **その他の用途の場合**:
    - 制度概要
    - 適用要件
    - 控除額・減額内容
- 「編集」ボタン（ステップ1へ遷移）

#### 3.4 証明者情報カード
- 証明者氏名
- 所属事務所名
- 組織種別
- 資格番号
- 発行日
- 「デフォルト設定」ボタン（設定ページへ）
- 「編集」ボタン（ステップ3へ遷移）

#### 3.5 改修工事一覧カード

**登録済み工事の表示**:
各工事種別ごとにカラーコーディング:
- 耐震改修: ブルー系
- バリアフリー: グリーン系
- 省エネ: オレンジ系
- 同居対応: パープル系
- 子育て対応: ピンク系
- その他: インディゴ系

**工事カードの内容**:
- アイコン + 工事種別名
- 費用サマリー（4列グリッド）:
  1. 工事費用
  2. 補助金控除後
  3. 控除対象額
  4. 上限適用後（太字強調）
- アクションボタン:
  - 「詳細」→ プレビューモーダル表示（NEW!）
  - 「編集」→ 各工事入力ページへ
  - 「削除」→ 確認後削除

**詳細プレビューモーダル**（NEW!）:
- 工事項目一覧テーブル
  - 工事名、単価、単位、数量、割合、計算額
- 計算サマリー
  - 工事費総額、補助金額、控除対象額
- アクションボタン:
  - 「閉じる」
  - 「編集する」

**工事追加セクション**:
- 6つの工事種別ボタン（グリッド表示）
- 既に登録済みの工事は背景色付き

#### 3.6 統合計算結果カード
複数の改修工事がある場合のみ表示:
- Excel Row 442-460の計算ロジック
- 最大工事費（補助金差引後）
- 最大控除額（10%控除分、1,000万円上限適用済み）
- 超過額（ある場合は警告表示）
- 最終控除対象額
- 残り控除可能額

### モーダル

#### 削除確認モーダル
- タイトル: 「証明書を削除しますか？」
- 警告メッセージ
- アクションボタン:
  - 「キャンセル」
  - 「削除する」（赤色）

#### 用途区分詳細モーダル（NEW!）
- ヘッダー: 用途名 + Excel行番号参照
- 内容: 用途に応じた詳細表示
  - 住宅借入金等特別控除: 入力データ表示
  - その他: 制度説明
- 「閉じる」ボタン

---

## 4. 改修工事入力ページ（共通構造）

### ページ一覧
1. `/seismic-reform` - 耐震改修工事
2. `/barrier-free-reform` - バリアフリー改修工事
3. `/energy-saving-reform` - 省エネ改修工事
4. `/cohabitation-reform` - 同居対応改修工事
5. `/childcare-reform` - 子育て対応改修工事
6. `/other-renovation` - その他増改築等工事

### 共通UI要素

#### ヘッダー
- アイコン + 工事種別名（大きく表示）
- サブタイトル: Excel行番号と説明
- 戻るボタン

#### 工事項目入力セクション
**工事種別選択**:
- プルダウンメニュー
- 各工事種別固有のコード体系（例: A-1, B-2など）

**入力フォーム**（工事種別により異なる）:
- 工事名（自動入力 or 手動入力）
- 単価（円）
- 単位（㎡、箇所、式など）
- 数量
- 割合（％、一部工事のみ）
- 窓面積比率（省エネ工事のみ）
- 地域区分（省エネ工事のみ）
- 居住者割合（同居・子育て工事）

**計算結果表示**:
- 計算額 = 単価 × 数量 × 割合（該当する場合）
- リアルタイム計算

**工事項目一覧テーブル**:
- 登録済み工事項目を表示
- 編集・削除ボタン
- 合計金額表示

#### サマリーセクション
- 補助金情報:
  - 補助金の有無（ラジオボタン）
  - 補助金額（円）
- 計算結果:
  - 工事費総額
  - 補助金差引後の金額
  - 控除対象額（工事種別により計算方法が異なる）

#### アクションボタン
- 「保存して証明書に戻る」（プライマリ）
- 「証明書詳細に戻る」（セカンダリ）

---

## 5. 住宅借入金詳細入力ページ

### URL
`/certificate/housing-loan-detail?certificateId={id}`

### セクション構成

#### (1) 実施した工事の種別
6つの工事カテゴリ（チェックボックス形式）:

**第1号工事**（青系）:
- ☑ 1 増築
- ☑ 2 改築
- ☑ 3 大規模の修繕
- ☑ 4 大規模の模様替

**第2号工事**（緑系）:
- 説明: 1棟の家屋でその構造上区分された数個の部分を独立して住居その他の用途に供することができるものの過半について行う修繕又は模様替
- ☑ 1 床の過半の修繕又は模様替
- ☑ 2 階段の過半の修繕又は模様替
- ☑ 3 間仕切壁の過半の修繕又は模様替
- ☑ 4 壁の過半の修繕又は模様替

**第3号工事**（紫系）:
- 説明: 一室の床又は壁の全部の修繕又は模様替
- ☑ 1 居室
- ☑ 2 調理室
- ☑ 3 浴室
- ☑ 4 便所
- ☑ 5 洗面所
- ☑ 6 納戸
- ☑ 7 玄関
- ☑ 8 廊下

**第4号工事（耐震改修工事）**（赤系）:
- ☑ 1 補強金物等法令に適合させる耐震改修又は耐震診断の4の規定
- ☑ 2 地震に対する安全性に係る基準

**第5号工事（バリアフリー改修工事）**（黄色系）:
- 説明: 高齢者等が自立した日常生活を営むのに必要な構造及び設備の改修工事
- ☑ 1 廊下等の出入口の拡幅
- ☑ 2 階段の勾配の緩和
- ☑ 3 浴室の改良
- ☑ 4 便所の改良
- ☑ 5 手すりの設置
- ☑ 6 床の段差の解消
- ☑ 7 出入口戸の改良
- ☑ 8 床材の滑り改良

**第6号工事（省エネ改修工事）**（藍色系）:
- 説明: エネルギー使用の合理化に資する修繕改修等
- 複雑な構成（増改築による認定、地域区分、改修工事前の住宅の断熱等性能等級など）

#### (2) 実施した工事の内容
- テキストエリア（複数行入力可能）
- プレースホルダー: 「実施した工事の内容を記入してください」

#### (3) 実施した工事の費用の概要
**① 第1号〜第6号工事に要した費用の額（円）**:
- 数値入力フィールド
- 0から開始

**② 補助金等の交付**:
- ラジオボタン: 有/無
- 「有」の場合、補助金額入力フィールド表示

**③ ①から②を差し引いた額（100万円以上必要）**:
- 自動計算
- 100万円未満の場合、警告表示（赤文字）

#### アクションボタン
- 「入力内容を確認する」→ プレビューモードで表示
- 「入力内容をプレビューで確認後、保存できます」（小さなテキスト）

---

## 6. 証明書プレビューページ（NEW!）

### URL
`/certificate/[id]/preview`

### 表示内容
Excel形式の証明書レイアウトをWeb上で再現:
- 証明書タイトル
- 申請者情報
- 物件情報
- 用途区分
- 改修工事詳細（工事種別ごとに表形式）
- 計算サマリー
- 証明者情報（署名欄含む）

### アクションボタン
- 「戻る」
- 「Excel出力」
- 「PDF出力」

---

## 7. 設定ページ

### URL
`/settings`

### 機能
証明者情報のデフォルト値を設定:
- 証明者氏名
- 所属事務所名
- 組織種別
- 資格番号

保存後、新規証明書作成時に自動入力される。

---

## 8. データフロー

### 証明書作成フロー
```
ダッシュボード
  ↓ 「新規証明書作成」クリック
証明書作成（ステップ1）基本情報入力
  ↓ 「次へ」
証明書作成（ステップ2）改修工事詳細
  ↓ 各工事種別をクリック
改修工事入力ページ（該当種別）
  ↓ 工事項目入力・保存
証明書作成（ステップ2）に戻る
  ↓ すべての工事入力完了後「次へ」
証明書作成（ステップ3）証明者情報入力
  ↓ 「確認画面へ」
確認ページ
  ↓ 「下書き保存」or「発行する」
証明書詳細ページ
  ↓ 「PDF出力」or「Excel出力」
証明書ファイルダウンロード
```

### 住宅借入金特別控除の場合の追加フロー
```
証明書作成（ステップ1）で「住宅借入金等特別控除」を選択
  ↓ ステップ2で「住宅借入金詳細入力」リンク表示
住宅借入金詳細入力ページ
  ↓ 工事種別・内容・費用入力
  ↓ 「入力内容を確認する」
プレビュー表示
  ↓ 「保存」
証明書作成（ステップ2）に戻る
```

---

## 9. カラーシステム

### 工事種別カラー
- 耐震改修: Blue (#2563eb)
- バリアフリー: Green (#16a34a)
- 省エネ: Orange (#ea580c)
- 同居対応: Purple (#9333ea)
- 子育て対応: Pink (#db2777)
- その他: Indigo (#4f46e5)

### ステータスカラー
- 下書き: Gray (#6b7280)
- 発行済み: Green (#16a34a)
- 完了: Blue (#2563eb)

### UI要素カラー
- プライマリボタン: Blue (#2563eb)
- セカンダリボタン: Gray (#6b7280)
- 危険ボタン（削除等）: Red (#dc2626)
- 成功メッセージ: Green (#16a34a)
- 警告メッセージ: Yellow (#eab308)
- エラーメッセージ: Red (#dc2626)

---

## 10. レスポンシブデザイン要件

### ブレークポイント（Tailwind CSS標準）
- sm: 640px
- md: 768px
- lg: 1024px
- xl: 1280px
- 2xl: 1536px

### モバイル対応（〜md）
- 統計カードを2列 → 1列に
- テーブルをカード形式に変換
- ナビゲーションをハンバーガーメニューに（将来実装）
- フォーム入力を縦積み

### タブレット対応（md〜lg）
- 統計カードを2列表示
- テーブルは横スクロール対応
- フォームは適度な余白

### デスクトップ対応（lg〜）
- 統計カードを4列表示
- テーブルは全列表示
- フォームは2列レイアウト可能

---

## 11. アクセシビリティ要件

- フォーム要素にlabelを必ず付与
- ボタンには適切なaria-labelを設定
- カラーコントラスト比4.5:1以上を確保
- キーボード操作に対応
- エラーメッセージは明確に表示

---

## 12. 主要なユーザーストーリー

### ストーリー1: 初めての証明書作成
```
建築士が初めてシステムを使う場合:
1. ダッシュボードに「証明書がまだありません」と表示
2. 「新規証明書作成」をクリック
3. ステップ1で基本情報を入力
4. ステップ2で改修工事（例: 耐震改修）を選択・入力
5. ステップ3で証明者情報を入力（初回のみ）
6. 確認画面で内容確認
7. 「発行する」をクリック
8. 証明書詳細ページで「PDF出力」
9. ダッシュボードに戻ると統計が更新されている
```

### ストーリー2: 複数工事の証明書作成
```
複数の改修工事を含む証明書を作成:
1. ダッシュボードから「新規証明書作成」
2. ステップ1で基本情報・用途「投資型減税」を入力
3. ステップ2で耐震改修工事を追加
4. 証明書詳細に戻り、バリアフリー改修も追加
5. 証明書詳細に戻り、省エネ改修も追加
6. 統合計算結果に1,000万円上限が適用される
7. すべて入力後、証明者情報入力
8. 「発行する」
```

### ストーリー3: 住宅借入金特別控除の証明書
```
住宅ローン減税用の証明書を作成:
1. ダッシュボードから「新規証明書作成」
2. ステップ1で用途「住宅借入金等特別控除」を選択
3. ステップ2で「住宅借入金詳細入力」リンクが表示
4. リンクをクリックして詳細入力ページへ
5. 第1号工事（増築）、第3号工事（浴室）、第5号工事（手すり設置等）を選択
6. 工事内容を詳細に記述
7. 費用概要（350万円、補助金50万円）を入力
8. 控除対象額が自動計算（300万円）
9. 「保存」して証明書作成フローに戻る
10. ステップ3で証明者情報入力
11. 確認画面で「発行する」
12. 証明書詳細ページの「詳細」ボタンで入力内容を確認可能
```

---

## 13. 今後の機能拡張候補

- ユーザー認証・複数ユーザー対応
- 証明書テンプレート機能
- 証明書の検索・フィルタリング機能
- 顧客管理機能
- 電子署名対応
- クラウドストレージ連携
- メール送信機能

---

## 補足情報

### データベース構造（主要テーブル）
- Certificate（証明書基本情報）
- HousingLoanDetail（住宅借入金詳細）
- SeismicWork（耐震改修工事）
- BarrierFreeWork（バリアフリー改修工事）
- EnergySavingWork（省エネ改修工事）
- CohabitationWork（同居対応改修工事）
- ChildcareWork（子育て対応改修工事）
- OtherRenovationWork（その他増改築等工事）
- LongTermHousingWork（長期優良住宅化工事）

### Excel出力のマッピング
- Row 1-377: 証明書基本情報
- Row 378-379: 用途区分
- Row 380-377: 住宅借入金詳細（該当する場合のみ）
- Row 378-460: 各改修工事詳細
- Row 442-460: 統合計算結果（複数工事がある場合）

---

以上が増改築等工事証明書管理システムの概要です。
ダッシュボードを中心とした直感的なUI/UXを重視し、専門的な税制計算を簡単に行えることを目指しています。
